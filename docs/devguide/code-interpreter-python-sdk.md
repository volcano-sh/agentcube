# Using CodeInterpreter with Python SDK

The AgentCube Python SDK (`agentcube`) provides a high-level wrapper for interacting with CodeInterpreter. It handles session lifecycle management, authentication, and secure communication (RSA encryption), allowing you to focus on executing code and managing files.

This guide describes how to install, configure, and use the SDK to build automation agents.

## Prerequisites

Before you begin, ensure your environment meets the following requirements:

*   **Python**: Version 3.8 or later.
*   **Network Access**: Access to the Workload Manager (Control Plane) and Router (Data Plane).
*   **Package Installation**:
    ```bash
    pip install agentcube-sdk
    ```

## 1. Initialize the Client

The `CodeInterpreterClient` is the main entry point. You can initialize it directly or use it as a context manager (recommended) to ensure sessions are automatically cleaned up.

**Configuration Parameters:**

*   `name` (Optional): The name of the CodeInterpreter CRD template to use (default: the CRD name).
*   `namespace` (Optional): The Kubernetes namespace where the agent runs (default: `"default"`).
*   `ttl` (Optional): Time-to-live for the session in seconds (default: `3600`).
*   `router_url`: The URL of the Data Plane Router (default from env "ROUTER_URL").

**Example: Basic Initialization**

```python
from agentcube import CodeInterpreterClient

# Initialize and start session
client = CodeInterpreterClient(
    name="my-agent-template",
    ttl=3600,
    verbose=True
)
```

## 2. Execute Commands and Code

The SDK provides distinct methods for running shell commands and executing code blocks.

### Run Shell Commands

Use `execute_command` to run system operations on the remote agent.

```python
# Check the current user and directory
output = client.execute_command("whoami && pwd")
print(output)
```

### Run Python Code

Use `run_code` to execute scripts in a specific language (currently supports `"python"`). This runs inside the secure sandbox.

```python
script = """
import math
print(f"The square root of 16 is {math.sqrt(16)}")
"""

result = client.run_code(language="python", code=script)
print(result)
```

## 3. File Management

You can transfer files between your local environment and the remote CodeInterpreter instance.

### Upload Files

Use `upload_file` to send local files to the sandbox.

```python
# Upload a data file for processing
client.upload_file(
    local_path="./local_data.csv", 
    remote_path="/tmp/data.csv"
)
```

### Download Files

Use `download_file` to retrieve results generated by your scripts.

```python
# Download the processed report
client.download_file(
    remote_path="/tmp/report.json", 
    local_path="./final_report.json"
)
```

### Write Content Directly

Use `write_file` to create text files on the remote server without a local source file.

```python
client.write_file(
    content="print('Hello World')", 
    remote_path="/tmp/hello.py"
)
```

## 4. Best Practices: Using Context Managers

To ensure that remote resources are terminated and local connections are closed properly, it is recommended to use the `with` statement.

**Complete Example:**

```python
from agentcube import CodeInterpreterClient

def process_data_task():
    # Session automatically starts here
    with CodeInterpreterClient(ttl=600) as sandbox:
        print(f"Session ID: {sandbox.session_id}")

        # 1. Create a Python script remotely
        script_content = """
import json
data = {"status": "processed", "value": 42}
with open('/tmp/result.json', 'w') as f:
    json.dump(data, f)
print("Data processed.")
        """
        
        # 2. Execute the script
        print("Executing remote script...")
        logs = sandbox.run_code("python", script_content)
        print(f"Remote Logs: {logs}")

        # 3. Download the result
        sandbox.download_file("/tmp/result.json", "./result.json")
        print("File downloaded to ./result.json")

    # Session automatically stops (deleted) here
```

## 5. Manual Lifecycle Management

If you cannot use a context manager (e.g., in a persistent web server), you must manually call `stop()` to free resources.

```python
client = CodeInterpreterClient(ttl=3600)

try:
    client.execute_command("echo 'Running long task...'")
finally:
    # Critical: Delete the remote Pod and close connections
    client.stop()
```
