name: Codespell

on:
  pull_request:
    branches:
      - main
      - "release-*"

jobs:
  codespell:
    name: Check for spelling errors
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Backup and remove problematic files
        run: |
          # Backup files that cause false positives
          mkdir -p /tmp/skip_backup
          find . -name "pyproject.toml" -exec cp --parents {} /tmp/skip_backup/ \;
          find . -name "package-lock.json" -exec cp --parents {} /tmp/skip_backup/ \;
          find . -name "package.json" -exec cp --parents {} /tmp/skip_backup/ \;
          # Remove problematic files temporarily
          find . -name "pyproject.toml" -delete
          find . -name "package-lock.json" -delete
          find . -name "package.json" -delete

      - name: Run codespell
        run: |
          pip install codespell
          codespell \
            --check-filenames \
            --skip .git,go.sum,*.png,*.jpg,*.svg,*.gif,*.sum,bin,vendor,node_modules \
            --ignore-words-list fo,nam,te,notin,NotIn \
            .

      - name: Restore backed up files
        run: |
          # Restore backed up files
          cd /tmp/skip_backup && find . -type f -exec cp --parents {} $GITHUB_WORKSPACE/ \;
